import{S as n}from"./sweetalert2.all-fe15363a.js";import{_ as x,r as g,o as r,a as d,d as v,b as t,F as _,g as m,k as b,t as l,l as y,w as L,j as C,m as $,f as I}from"./index-ad41416f.js";const{VITE_API:h,VITE_APIPATH:p}={VITE_API:"https://vue3-course-api.hexschool.io/",VITE_APIPATH:"whattoplay",BASE_URL:"/what_to_play/",MODE:"production",DEV:!1,PROD:!0},k={emits:["refreshCart"],data(){return{products:[],productId:"",cart:{},loadingItem:"",order_open:!1,isLoading:!1}},methods:{getCart(){this.isLoading=!0,this.$http.get(`${h}/v2/api/${p}/cart`).then(e=>{this.isLoading=!1,this.cart=e.data.data,this.cart.total=this.cart.total.toLocaleString(),this.cart.carts.length>0?this.order_open=!0:this.order_open=!1}).catch(e=>{this.isLoading=!1,n.fire({icon:"error",title:`錯誤 ${e.response.status}`,text:e.response.data.message,confirmButtonText:"OK"})})},updateProductQty(e){const o={product_id:e.product.id,qty:e.qty};this.loadingItem=e.id,this.isLoading=!0,this.$http.put(`${h}/v2/api/${p}/cart/${e.id}`,{data:o}).then(c=>{this.isLoading=!1,this.getCart(),this.loadingItem="",n.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2e3}).fire({icon:"success",title:c.data.message})}).catch(c=>{this.isLoading=!1,this.loadingItem="",n.fire({icon:"error",title:`錯誤 ${c.response.status}`,text:c.response.data.message,confirmButtonText:"OK"})})},deleteProduct(e){this.loadingItem=e.id,this.isLoading=!0,this.$http.delete(`${h}/v2/api/${p}/cart/${e.id}`).then(o=>{this.isLoading=!1,this.getCart(),this.loadingItem="",n.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2e3}).fire({icon:"warning",title:`${o.data.message}該商品`}),this.$emit("refreshCart")}).catch(o=>{this.isLoading=!1,n.fire({icon:"error",title:`錯誤 ${o.response.status}`,text:o.response.data.message,confirmButtonText:"OK"})})},deleteAllProduct(){this.isLoading=!0,this.$http.delete(`${h}/v2/api/${p}/carts`).then(e=>{this.isLoading=!1,this.getCart(),n.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2e3}).fire({icon:"warning",title:`${e.data.message}全部商品`}),this.$emit("refreshCart")}).catch(e=>{this.isLoading=!1,n.fire({icon:"error",title:`錯誤 ${e.response.status}`,text:e.response.data.message,confirmButtonText:"OK"})})}},mounted(){this.getCart()}},T={class:"container mt-5"},V={class:"mt-3"},P=["disabled"],B=t("h3",{class:"mt-3 mb-4"},"購物車",-1),A={class:"row"},S={class:"col-md-8"},E={class:"table"},N=t("thead",null,[t("tr",null,[t("th"),t("th",{scope:"col",class:"border-0 ps-0"},"品名"),t("th",{scope:"col",class:"border-0"},"數量"),t("th",{scope:"col",class:"border-0 text-end"},"總計")])],-1),O={class:"border-0 align-middle"},D=["onClick","disabled"],U={scope:"row",class:"border-0 px-0 font-weight-normal py-4"},q=["src"],K={class:"mb-0 fw-bold ms-md-3 d-inline-block"},j={class:"border-0 align-middle"},F={class:"input-group input-group-sm"},H=["onUpdate:modelValue","onChange","disabled"],M=["value"],Q={class:"border-0 align-middle text-end"},R={class:"mb-0 ms-auto"},z={class:"col-md-4"},G={class:"border p-4 mb-4"},J=t("h4",{class:"fw-bold mb-4"},"Order Detail",-1),W={class:"table text-muted border-bottom"},X=t("tr",null,[t("th",{scope:"row",class:"border-0 px-0 pt-4 font-weight-normal"},"Subtotal")],-1),Y={scope:"row",class:"border-0 px-0 pt-4 font-weight-normal"},Z={class:"text-end border-0 px-0 pt-4"},tt={class:"d-flex justify-content-between mt-4"},et=t("p",{class:"mb-0 h4 fw-bold"},"Total",-1),st={class:"mb-0 h4 fw-bold"};function ot(e,o,c,it,i,u){const f=g("LoadingView"),w=g("router-link");return r(),d("div",T,[v(f,{active:i.isLoading,"onUpdate:active":o[0]||(o[0]=s=>i.isLoading=s)},null,8,["active"]),t("div",V,[t("button",{type:"button",class:"btn btn-outline-warning rounded-0",onClick:o[1]||(o[1]=s=>u.deleteAllProduct()),disabled:!i.order_open}," 清空購物車 ",8,P),B,t("div",A,[t("div",S,[t("table",E,[N,t("tbody",null,[i.cart.carts?(r(!0),d(_,{key:0},m(i.cart.carts,s=>(r(),d("tr",{key:s.id,class:"border-bottom border-top"},[t("td",O,[t("button",{type:"button",class:"btn btn-outline-warning btn-sm rounded-0",onClick:a=>u.deleteProduct(s),disabled:s.id===i.loadingItem}," x ",8,D)]),t("td",U,[t("img",{src:s.product.imageUrl,alt:"productImage",style:{width:"72px",height:"72px","object-fit":"cover"}},null,8,q),t("p",K,l(s.product.title),1)]),t("td",j,[t("div",F,[C(t("select",{class:"form-control","onUpdate:modelValue":a=>s.qty=a,onChange:a=>u.updateProductQty(s),disabled:s.id===i.loadingItem},[(r(),d(_,null,m(20,a=>t("option",{value:a,key:"cart"+a},l(a),9,M)),64))],40,H),[[$,s.qty]])])]),t("td",Q,[t("p",R,"NT$"+l(s.total.toLocaleString()),1)])]))),128)):b("",!0)])])]),t("div",z,[t("div",G,[J,t("table",W,[t("tbody",null,[X,(r(!0),d(_,null,m(i.cart.carts,s=>(r(),d("tr",{key:s.id},[t("th",Y,l(s.product.title),1),t("td",Z,"NT$"+l(s.total.toLocaleString()),1)]))),128))])]),t("div",tt,[et,t("p",st,"NT$"+l(i.cart.total),1)]),i.order_open?(r(),y(w,{key:0,to:"/checkout",class:"btn btn-primary w-100 mt-4"},{default:L(()=>[I("確認購買")]),_:1})):b("",!0)])])])])])}const rt=x(k,[["render",ot]]);export{rt as default};
